## cypress-image-diff-js - saving diff images to Currents dashboard

This is a (simple) demo project that showcases how to capture and browse visual regression diff images generated by Cypress with Currents dashboard.

### Setup

Checkout the repo and run `yarn install`

### Usage

Create an account on Currents dashboard and run the tests as usual

```
npx currents run --parallel --record --key <your_key> --ci-build-id `date +%s`
```

When the run is finished, it will upload the images to Currents Dashboard. You can now browse the screenshot of the visual regression diff images:

<img width="1531" alt="cypress - visual image diff@2x" src="https://user-images.githubusercontent.com/1637928/202931113-3abb0bb4-2396-489d-846c-4ef31fce2950.png">


### Implementation

Behind the scenes - we create a local HTTP server that can browse the local filesystem (see `cypress.config.js`).

As part of `afterEach` hook, we:

- `cy.visit` the local HTTP server, opening the [report](https://github.com/uktrade/cypress-image-diff/blob/main/docs/Reporting.md) generated by [cypress-image-diff](https://github.com/uktrade/cypress-image-diff)
- take a screenshot of the report
- cypress automatically uploads the report screenshot to Currents Dashboard

### Misc

- It uses an SSL key and certificate to create a local HTTPS server
- It uses `cy.origin` to open `https://0.0.0.0:8081`, which can be different from the origin under test
